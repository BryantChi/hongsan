{
    "sourceFile": "app/Http/Controllers/CatetypeController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1753263609808,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1753269695421,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -182,10 +182,16 @@\n         $seoInfo = SeoSettingRepository::getInfo('/products');\n \n         // 取得產品資訊，並載入翻譯\n         $product = ProductsInfo::with(['translations' => function ($query) {\n-            $query->where('locale', app()->getLocale());\n-        }])->findOrFail($id);\n+                $query->where('locale', app()->getLocale());\n+            },\n+            'productCategories' => function ($query) {\n+                $query->with(['translations' => function ($q) {\n+                    $q->where('locale', app()->getLocale());\n+                }]);\n+            }\n+        ])->findOrFail($id);\n \n         // 取得產品圖片\n         $images = $product->images;\n \n"
                },
                {
                    "date": 1753272921165,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,10 +67,10 @@\n         if ($request->has('category')) {\n             $category = $request->input('category');\n             // $query->where('product_categories_id', $category);\n             $query->whereHas('productCategories', function($q) use ($category) {\n-                $q->where('id', $category);\n-            });\n+        $q->where('product_categories.id', $category);\n+    });\n         }\n \n         // 分頁查詢\n         $machineryList = $query->orderBy('created_at', 'desc')->paginate(12);\n@@ -143,10 +143,10 @@\n         if ($request->has('category')) {\n             $category = $request->input('category');\n             // $query->where('product_categories_id', $category);\n             $query->whereHas('productCategories', function($q) use ($category) {\n-                $q->where('id', $category);\n-            });\n+        $q->where('product_categories.id', $category);\n+    });\n         }\n \n         // 分頁查詢\n         $machineryList = $query->orderBy('created_at', 'desc')->paginate(12);\n"
                },
                {
                    "date": 1753272955130,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,10 +67,10 @@\n         if ($request->has('category')) {\n             $category = $request->input('category');\n             // $query->where('product_categories_id', $category);\n             $query->whereHas('productCategories', function($q) use ($category) {\n-        $q->where('product_categories.id', $category);\n-    });\n+                $q->where('product_categories.id', $category);\n+            });\n         }\n \n         // 分頁查詢\n         $machineryList = $query->orderBy('created_at', 'desc')->paginate(12);\n@@ -143,10 +143,10 @@\n         if ($request->has('category')) {\n             $category = $request->input('category');\n             // $query->where('product_categories_id', $category);\n             $query->whereHas('productCategories', function($q) use ($category) {\n-        $q->where('product_categories.id', $category);\n-    });\n+                $q->where('product_categories.id', $category);\n+            });\n         }\n \n         // 分頁查詢\n         $machineryList = $query->orderBy('created_at', 'desc')->paginate(12);\n"
                }
            ],
            "date": 1753263609807,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers;\n\nuse App\\Models\\Admin\\ProductsInfo;\nuse App\\Repositories\\Admin\\SeoSettingRepository;\nuse Illuminate\\Http\\Request;\n\nclass CatetypeController extends Controller\n{\n    //\n    public function index()\n    {\n        $seoInfo = SeoSettingRepository::getInfo('/catetype');\n        return view('catetype')\n        ->with('seoInfo', $seoInfo);\n    }\n\n    public function construction()\n    {\n        $seoInfo = SeoSettingRepository::getInfo('/construction');\n        return view('construction')\n        ->with('seoInfo', $seoInfo);\n    }\n\n    public function constructionRent(Request $request)\n    {\n        $seoInfo = SeoSettingRepository::getInfo('/construction-rent');\n\n        // 取得目前語系翻譯所有分類資訊,\n        $categoriesInfo = \\App\\Models\\Admin\\ProductCategories::query()\n            ->with([\n                'translations' => function ($query) {\n                    $query->where('locale', app()->getLocale());\n                }\n            ])\n            ->where('application_categories_info_id', 1)\n            ->get();\n\n        return view('construction-rent')\n        ->with('seoInfo', $seoInfo)->with('categoriesInfo', $categoriesInfo);\n    }\n\n    public function constructionRentList(Request $request)\n    {\n        $seoInfo = SeoSettingRepository::getInfo('/construction-rent-list');\n\n        $query = ProductsInfo::query();\n\n        $query->with([\n                'translations' => function ($query) {\n                    $query->where('locale', app()->getLocale());\n                }\n            ]);\n\n        // 這裡可以根據需要添加其他條件\n        $query->where('application_categories_info_id', 1); // 1 是建設類別的 ID\n\n        // 如果有搜尋條件，可以在這裡添加\n        // 依品牌搜尋\n        if ($request->has('brand')) {\n            $brand = $request->input('brand');\n            $query->where('brands_info_id', $brand);\n        }\n\n        // 如果有分類搜尋\n        if ($request->has('category')) {\n            $category = $request->input('category');\n            // $query->where('product_categories_id', $category);\n            $query->whereHas('productCategories', function($q) use ($category) {\n                $q->where('id', $category);\n            });\n        }\n\n        // 分頁查詢\n        $machineryList = $query->orderBy('created_at', 'desc')->paginate(12);\n\n        // // 取得目前語系翻譯所有品牌資訊,\n        // $brandsInfo = \\App\\Models\\Admin\\BrandsInfo::query()\n        //     ->with([\n        //         'translations' => function ($query) {\n        //             $query->where('locale', app()->getLocale());\n        //         }\n        //     ])\n        //     ->where('application_categories_info_id', 1)\n        //     ->get();\n\n        // // 取得目前語系翻譯所有分類資訊,\n        // $categoriesInfo = \\App\\Models\\Admin\\ProductCategories::query()\n        //     ->with([\n        //         'translations' => function ($query) {\n        //             $query->where('locale', app()->getLocale());\n        //         }\n        //     ])\n        //     ->where('application_categories_info_id', 1)\n        //     ->get();\n\n        return view('construction-rent-list')\n        ->with('seoInfo', $seoInfo)->with('machineryList', $machineryList);\n    }\n\n    public function constructionBuy(Request $request)\n    {\n        $seoInfo = SeoSettingRepository::getInfo('/construction-buy');\n\n        // 取得目前語系翻譯所有品牌資訊,\n        $brandsInfo = \\App\\Models\\Admin\\BrandsInfo::query()\n            ->with([\n                'translations' => function ($query) {\n                    $query->where('locale', app()->getLocale());\n                }\n            ])\n            ->where('application_categories_info_id', 1)\n            ->get();\n\n        return view('construction-buy')\n        ->with('seoInfo', $seoInfo)->with('brandsInfo', $brandsInfo);\n    }\n\n    public function constructionBuyList(Request $request)\n    {\n        $seoInfo = SeoSettingRepository::getInfo('/construction-buy-list');\n\n        $query = ProductsInfo::query();\n\n        $query->with([\n                'translations' => function ($query) {\n                    $query->where('locale', app()->getLocale());\n                }\n            ]);\n\n        // 這裡可以根據需要添加其他條件\n        $query->where('application_categories_info_id', 1); // 1 是建設類別的 ID\n\n        // 如果有搜尋條件，可以在這裡添加\n        // 依品牌搜尋\n        if ($request->has('brand')) {\n            $brand = $request->input('brand');\n            $query->where('brands_info_id', $brand);\n        }\n\n        // 如果有分類搜尋\n        if ($request->has('category')) {\n            $category = $request->input('category');\n            // $query->where('product_categories_id', $category);\n            $query->whereHas('productCategories', function($q) use ($category) {\n                $q->where('id', $category);\n            });\n        }\n\n        // 分頁查詢\n        $machineryList = $query->orderBy('created_at', 'desc')->paginate(12);\n\n        // // 取得目前語系翻譯所有品牌資訊,\n        // $brandsInfo = \\App\\Models\\Admin\\BrandsInfo::query()\n        //     ->with([\n        //         'translations' => function ($query) {\n        //             $query->where('locale', app()->getLocale());\n        //         }\n        //     ])\n        //     ->where('application_categories_info_id', 1)\n        //     ->get();\n\n        // 取得目前語系翻譯所有分類資訊,\n        $categoriesInfo = \\App\\Models\\Admin\\ProductCategories::query()\n            ->with([\n                'translations' => function ($query) {\n                    $query->where('locale', app()->getLocale());\n                }\n            ])\n            ->where('application_categories_info_id', 1)\n            ->get();\n\n        return view('construction-buy-list')\n        ->with('seoInfo', $seoInfo)->with('machineryList', $machineryList)\n        ->with('categoriesInfo', $categoriesInfo);\n    }\n\n    public function productIntro($locale, $id)\n    {\n        // 取得 SEO 設定\n        $seoInfo = SeoSettingRepository::getInfo('/products');\n\n        // 取得產品資訊，並載入翻譯\n        $product = ProductsInfo::with(['translations' => function ($query) {\n            $query->where('locale', app()->getLocale());\n        }])->findOrFail($id);\n\n        // 取得產品圖片\n        $images = $product->images;\n\n        return view('product-intro', compact('product', 'seoInfo', 'images'));\n    }\n}\n"
        }
    ]
}